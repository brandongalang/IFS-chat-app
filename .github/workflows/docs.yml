name: Documentation
on:
  pull_request:
    types: [opened, synchronize, reopened, ready_for_review]

jobs:
  docs-reminder:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Check if docs might need updating
        id: check-docs
        continue-on-error: true
        env:
          BASE_SHA: ${{ github.event.pull_request.base.sha }}
          HEAD_SHA: ${{ github.sha }}
        run: node .github/scripts/docs-reminder.mjs

      - name: Post docs reminder comment
        if: steps.check-docs.outputs.needs-docs == 'true'
        uses: actions/github-script@v7
        with:
          script: |
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: `ðŸ“š **Documentation Reminder**

This PR modifies code that may require documentation updates. Please check if docs need updating:

1. Review your code changes
2. Check \`docs/.docmap.json\` for mapped documentation files
3. Update relevant docs in \`docs/features/\`, \`docs/current/\`, or other relevant sections
4. If no docs update is needed, add the \`docs:skip\` label with a brief explanation

**Tip:** Use the \`docs:skip\` label if this change doesn't affect user-facing features, behavior, or configuration.`
            })

      - name: Verify docs updated (informational only)
        continue-on-error: true
        env:
          BASE_SHA: ${{ github.event.pull_request.base.sha }}
          HEAD_SHA: ${{ github.sha }}
        run: node .github/scripts/docs-check.mjs
